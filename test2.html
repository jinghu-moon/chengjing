<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>滑动胶囊 Tab - 无按钮滚动条版</title>
    <style>
      :root {
        --ease-elastic: cubic-bezier(0.34, 1.25, 0.64, 1);
        --color-primary: #5e81ac;
        --bg-panel: #e5e9f0;
        --bg-active: #ffffff;
        --radius-box: 12px;
        --radius-item: 8px;
        --grid-gap: 8px; 
      }

      * { box-sizing: border-box; margin: 0; padding: 0; }

      body {
        font-family: system-ui, -apple-system, sans-serif;
        background-color: #eceff4;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 40px;
        min-height: 100vh;
        color: #2e3440;
      }

      /* --- 控制面板 --- */
      .controls-group {
        display: flex;
        gap: 20px;
        background: #fff;
        padding: 15px 25px;
        border-radius: 16px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        align-items: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .control-item { display: flex; align-items: center; gap: 8px; font-size: 14px; color: #4c566a; transition: opacity 0.3s; }
      .control-item.disabled { opacity: 0.4; pointer-events: none; }
      .divider { width: 1px; height: 20px; background: #d8dee9; margin: 0 10px; }
      .input-number { width: 50px; padding: 4px; border: 1px solid #d8dee9; border-radius: 6px; text-align: center; outline: none; }

      /* --- 容器 Wrapper --- */
      .capsule-tabs-wrapper {
        width: 100%;
        transition: max-width 0.3s, max-height 0.3s;
        
        background: var(--bg-panel);
        border-radius: var(--radius-box);
        border: 1px solid rgba(0,0,0,0.05);
        
        /* 给滚动条留一点内边距，防止贴得太死 */
        padding: 6px; 
        padding-right: 2px; 
        
        display: flex; 
        flex-direction: column; 
        
        /* Firefox 适配 */
        scrollbar-width: thin; 
        scrollbar-color: rgba(0,0,0,0.1) transparent; 
        
        overflow: hidden; 
      }

      /* --- [核心修改] 滚动条样式 --- */
      
      .capsule-tabs-wrapper::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }

      .capsule-tabs-wrapper::-webkit-scrollbar-track {
        background: transparent;
        margin: 6px 0; /* 留出边距 */
      }

      .capsule-tabs-wrapper::-webkit-scrollbar-thumb {
        background-color: transparent; 
        border-radius: 10px;
        border: 1px solid transparent; 
        background-clip: content-box;
      }

      /* 鼠标悬停显示 */
      .capsule-tabs-wrapper:hover::-webkit-scrollbar-thumb {
        background-color: rgba(0, 0, 0, 0.15); 
      }
      .capsule-tabs-wrapper::-webkit-scrollbar-thumb:hover {
        background-color: rgba(0, 0, 0, 0.3);
      }

      /* --- Tabs 内容区 --- */
      .capsule-tabs {
        position: relative;
        display: inline-flex;
        background: transparent;
        border: none;
        padding: 0;
        transition: gap 0.3s; 
        box-sizing: border-box;
      }

      .capsule-tabs.layout-grid {
        display: grid;
        gap: var(--grid-gap);
        width: fit-content; 
        min-width: 100%; 
        padding-right: 4px; /* 视觉补偿 */
      }

      /* --- 指示器 --- */
      .capsule-indicator {
        position: absolute;
        top: 0; left: 0;
        background: var(--bg-active);
        border-radius: var(--radius-item);
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        opacity: 0;
        pointer-events: none;
        z-index: 0;
        transition: transform 0.35s var(--ease-elastic), 
                    width 0.35s var(--ease-elastic), 
                    height 0.35s var(--ease-elastic);
      }
      .capsule-indicator.initialized { opacity: 1; }
      .capsule-indicator.no-transition { transition: none !important; }

      /* --- Tab --- */
      .capsule-tab {
        position: relative;
        z-index: 1;
        padding: 10px 12px;
        min-width: 80px; 
        cursor: pointer;
        user-select: none;
        color: #4c566a;
        font-size: 14px;
        border-radius: var(--radius-item);
        transition: color 0.2s, width 0.3s var(--ease-elastic);
        display: inline-grid;
        grid-template-areas: "stack";
        place-items: center;
      }

      .capsule-tabs.layout-grid .capsule-tab {
        width: 100% !important; 
        padding: 12px 0;
      }
      
      .capsule-tab:focus-visible { outline: none; } 

      .tab-content {
        grid-area: stack;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        white-space: nowrap;
        transition: opacity 0.2s;
      }

      .tab-ghost {
        grid-area: stack;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        visibility: hidden;
        pointer-events: none;
        font-weight: 600; 
        white-space: nowrap;
      }

      .capsule-tab.active .tab-content {
        color: var(--color-primary);
        font-weight: 600;
      }

      /* Switch */
      .switch { position: relative; display: inline-block; width: 36px; height: 20px;}
      .switch input { opacity: 0; width: 0; height: 0; }
      .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #d8dee9; transition: .4s; border-radius: 34px; }
      .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
      input:checked + .slider { background-color: var(--color-primary); }
      input:checked + .slider:before { transform: translateX(16px); }
    </style>
  </head>
  <body>

    <div class="controls-group">
      <div class="control-item">
        <span>网格模式</span>
        <label class="switch">
          <input type="checkbox" id="layoutToggle" />
          <span class="slider"></span>
        </label>
      </div>

      <div class="divider"></div>

      <div class="control-item" id="widthControl">
        <span>所有 Tab 等宽</span>
        <label class="switch">
          <input type="checkbox" id="widthToggle" />
          <span class="slider"></span>
        </label>
      </div>
      
      <div class="control-item disabled" id="colLimitControl">
        <span>列数</span>
        <input type="number" id="colLimitInput" class="input-number" value="6" min="1" max="10">
      </div>

      <div class="control-item disabled" id="rowLimitControl">
        <span>可见行</span>
        <input type="number" id="rowLimitInput" class="input-number" value="3" min="1" max="10">
      </div>
    </div>

    <!-- Wrapper -->
    <div class="capsule-tabs-wrapper">
      <!-- Tabs -->
      <div class="capsule-tabs" id="tabs" role="tablist">
        <div class="capsule-indicator"></div>
        <div class="capsule-tab active"><div class="tab-content">首页概览</div></div>
        <div class="capsule-tab"><div class="tab-content">API 接口</div></div>
        <div class="capsule-tab"><div class="tab-content">配置中心</div></div>
        <div class="capsule-tab"><div class="tab-content">账户安全</div></div>
        <div class="capsule-tab"><div class="tab-content">审计日志</div></div>
        <div class="capsule-tab"><div class="tab-content">数据分析</div></div>
        <div class="capsule-tab"><div class="tab-content">偏好设置</div></div>
        <div class="capsule-tab"><div class="tab-content">团队管理</div></div>
        <div class="capsule-tab"><div class="tab-content">账单支付</div></div>
        <div class="capsule-tab"><div class="tab-content">通知中心</div></div>
        <div class="capsule-tab"><div class="tab-content">外部集成</div></div>
        <div class="capsule-tab"><div class="tab-content">帮助文档</div></div>
        <div class="capsule-tab"><div class="tab-content">关于我们</div></div>
        <div class="capsule-tab"><div class="tab-content">版本更新</div></div>
        <div class="capsule-tab"><div class="tab-content">退出登录</div></div>
      </div>
    </div>

    <script>
      const tabs = document.querySelectorAll(".capsule-tab");
      const indicator = document.querySelector(".capsule-indicator");
      const container = document.querySelector(".capsule-tabs");
      const wrapper = document.querySelector(".capsule-tabs-wrapper");
      
      const layoutToggle = document.getElementById("layoutToggle");
      const widthToggle = document.getElementById("widthToggle");
      const widthControl = document.getElementById("widthControl");
      const rowLimitInput = document.getElementById("rowLimitInput");
      const colLimitInput = document.getElementById("colLimitInput");
      const rowLimitControl = document.getElementById("rowLimitControl");
      const colLimitControl = document.getElementById("colLimitControl");

      let maxTabWidth = 0;
      let isWindowResizing = false;
      let resizeTimer = null;

      function initGhostElements() {
        tabs.forEach(tab => {
          const content = tab.querySelector('.tab-content');
          if (content && !tab.querySelector('.tab-ghost')) {
            const ghost = content.cloneNode(true);
            ghost.className = 'tab-ghost';
            tab.appendChild(ghost);
          }
        });
      }

      function calculateMaxTabWidth() {
        tabs.forEach(tab => tab.style.width = '');
        maxTabWidth = 0;
        tabs.forEach(tab => {
          const w = tab.getBoundingClientRect().width;
          if (w > maxTabWidth) maxTabWidth = w;
        });
      }

      window.addEventListener('resize', () => {
        isWindowResizing = true;
        updateIndicator(false);
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => isWindowResizing = false, 200);
      });

      const resizeObserver = new ResizeObserver(entries => {
        updateIndicator(!isWindowResizing);
      });

      function scrollActiveIntoView(tab) {
        const isGrid = layoutToggle.checked;
        const tabLeft = tab.offsetLeft;
        const tabTop = tab.offsetTop;
        const tabWidth = tab.offsetWidth;
        const tabHeight = tab.offsetHeight;
        const wrapperWidth = wrapper.offsetWidth;
        const wrapperHeight = wrapper.clientHeight;

        if (!isGrid) {
          const scrollTo = tabLeft - wrapperWidth / 2 + tabWidth / 2;
          wrapper.scrollTo({ left: scrollTo, behavior: "smooth" });
        } else {
          const scrollTop = tabTop - wrapperHeight / 2 + tabHeight / 2;
          const scrollLeft = tabLeft - wrapperWidth / 2 + tabWidth / 2;
          wrapper.scrollTo({ top: scrollTop, left: scrollLeft, behavior: "smooth" });
        }
      }

      function updateIndicator(enableTransition = true) {
        const activeTab = document.querySelector(".capsule-tab.active");
        if (!activeTab) return;

        if (!enableTransition) {
            indicator.classList.add('no-transition');
        } else {
            indicator.classList.remove('no-transition');
        }

        const left = activeTab.offsetLeft;
        const top = activeTab.offsetTop;
        const width = activeTab.offsetWidth;
        const height = activeTab.offsetHeight;

        indicator.style.width = `${width}px`;
        indicator.style.height = `${height}px`;
        indicator.style.transform = `translate(${left}px, ${top}px)`;

        if(!enableTransition) {
             indicator.offsetHeight; 
             requestAnimationFrame(() => indicator.classList.remove('no-transition'));
        }

        scrollActiveIntoView(activeTab);
      }

      function updateLayout() {
        const isGrid = layoutToggle.checked;
        const isEqualWidth = widthToggle.checked;

        if (!isGrid) {
          container.classList.remove("layout-grid");
          container.style.gridTemplateColumns = '';
          wrapper.style.maxHeight = '';
          wrapper.style.overflowY = 'hidden';
          wrapper.style.overflowX = 'auto';
          wrapper.style.maxWidth = "100%";
          container.style.width = ''; 
          container.style.minWidth = '';

          widthControl.classList.remove("disabled");
          colLimitControl.classList.add("disabled");
          rowLimitControl.classList.add("disabled");

          tabs.forEach(tab => {
             if (isEqualWidth) {
                 tab.style.width = `${maxTabWidth}px`;
             } else {
                 tab.style.width = ''; 
             }
          });

        } else {
          container.classList.add("layout-grid");
          wrapper.style.maxWidth = "400px"; 

          widthControl.classList.add("disabled");
          colLimitControl.classList.remove("disabled");
          rowLimitControl.classList.remove("disabled");

          const cols = parseInt(colLimitInput.value) || 2;
          container.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
          
          tabs.forEach(tab => tab.style.width = '');

          const rows = parseInt(rowLimitInput.value) || 3;
          const sampleTab = tabs[0];
          const tabHeight = sampleTab.offsetHeight || 44;
          const gap = 8;
          // 注意：Wrapper padding 6px * 2 = 12px
          const wrapperPadding = 12; 
          const totalGap = Math.max(0, rows - 1) * gap;
          const visibleHeight = (tabHeight * rows) + totalGap + wrapperPadding;
          
          wrapper.style.maxHeight = `${visibleHeight}px`;
          wrapper.style.overflowY = 'auto'; 
          wrapper.style.overflowX = 'auto'; 
        }
      }

      function setActiveTab(tab) {
        const oldActive = document.querySelector(".capsule-tab.active");
        if (oldActive) resizeObserver.unobserve(oldActive);

        tabs.forEach(t => t.classList.remove("active"));
        tab.classList.add("active");
        
        resizeObserver.observe(tab);
        updateIndicator(true);
      }

      function handleControlsChange() {
        indicator.classList.add('no-transition');
        updateLayout();
        requestAnimationFrame(() => {
            updateIndicator(false);
        });
      }

      function initKeyboardNav() {
        container.addEventListener("keydown", (e) => {
          const isGrid = layoutToggle.checked;
          const activeTab = document.querySelector(".capsule-tab.active");
          const tabList = Array.from(tabs);
          const index = tabList.indexOf(activeTab);
          const cols = parseInt(colLimitInput.value) || 2;

          let nextIndex = null;
          if (e.key === "ArrowRight") nextIndex = index + 1;
          if (e.key === "ArrowLeft") nextIndex = index - 1;
          
          if (isGrid) {
            if (e.key === "ArrowDown") nextIndex = index + cols;
            if (e.key === "ArrowUp") nextIndex = index - cols;
          }

          if (nextIndex !== null) {
            e.preventDefault();
            if (nextIndex >= 0 && nextIndex < tabList.length) {
                setActiveTab(tabList[nextIndex]);
            }
          }
        });
      }

      window.addEventListener("load", () => {
        initGhostElements();    
        calculateMaxTabWidth(); 

        tabs.forEach(tab => tab.addEventListener("click", () => setActiveTab(tab)));
        
        layoutToggle.addEventListener("change", handleControlsChange);
        widthToggle.addEventListener("change", handleControlsChange); 
        
        [rowLimitInput, colLimitInput].forEach(input => {
          input.addEventListener("input", updateLayout);
        });

        const firstTab = document.querySelector('.capsule-tab.active');
        if(firstTab) resizeObserver.observe(firstTab);

        initKeyboardNav();
        handleControlsChange(); 
        
        setTimeout(() => indicator.classList.add("initialized"), 100);
      });
    </script>
  </body>
</html>